<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Arc Raiders | Weapon Analytics</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body>
  <div class="container">
    <h1>Arc Raiders // Tactical Intel</h1>

    <div class="controls">
      <div>
        <label for="searchInput">Search: </label>
        <input type="text" id="searchInput" placeholder="Weapon name..." />
      </div>

      <div>
        <label for="armor">Target Armor: </label>
        <select id="armor">
          <option value="0">Unarmored (0)</option>
          <option value="L">Light (L)</option>
          <option value="M" selected>Medium (M)</option>
          <option value="H">Heavy (H)</option>
        </select>
      </div>

      <div>
        <label for="zone">Hit Zone: </label>
        <select id="zone">
          <option value="Body" selected>Body Shot</option>
          <option value="Head">Headshot</option>
          <option value="Leg">Leg Shot</option>
          <option value="Overall">Overall (Weighted)</option>
        </select>
      </div>

      <div>
        <label for="category">Category: </label>
        <select id="category">
          <option value="All">All Categories</option>
        </select>
      </div>

      <div>
        <label for="scoreMode">Score Mode: </label>
        <select id="scoreMode">
          <option value="META" selected>Meta (Balanced)</option>
          <option value="CQC">CQC (Close)</option>
          <option value="MID">Mid-Range (AR)</option>
          <option value="LONG">Long-Range (DMR/Sniper)</option>
          <option value="CUSTOM">Custom (Sliders)</option>
        </select>
      </div>

      <div>
        <label for="chartMetric">Chart: </label>
        <select id="chartMetric">
          <option value="SCORE" selected>Score (Higher is Better)</option>
          <option value="TTK">TTK (Lower is Better)</option>
        </select>
      </div>

      <div class="pill" id="statusPill">Loadingâ€¦</div>
    </div>

    <div class="dashboard-grid">
      <div class="main">
        <div class="card">
          <h3 id="chartTitle">Performance Landscape</h3>
          <canvas id="mainChart" height="110"></canvas>
          <div class="note">
            Score is a normalized weighted composite (0â€“100) over the currently filtered set. For category fairness, Range is normalized within category.
          </div>
          <div class="note">
            Overall (Weighted) uses Head/Body/Leg weights: <b>20% / 70% / 10%</b>. Adjust in <code>OVERALL_HIT_WEIGHTS</code>.
          </div>
        </div>

        <div class="card">
          <h3>Weapon Arsenal</h3>
          <div style="overflow-x:auto;">
            <table id="weaponTable">
              <thead>
                <tr>
                  <th class="sortable" data-sort="Name">Weapon</th>
                  <th class="sortable" data-sort="Score">Score</th>
                  <th class="sortable" data-sort="TTK">TTK</th>
                  <th class="sortable" data-sort="DPS">DPS</th>
                  <th class="sortable" data-sort="Sustain">Sustain</th>
                  <th class="sortable" data-sort="Reload">Reload</th>
                  <th class="sortable" data-sort="Range">Range</th>
                  <th class="sortable" data-sort="HeadDep">Head Dep</th>
                  <th class="sortable" data-sort="ArmorCons">Armor</th>
                  <th class="sortable" data-sort="ArmorBP">Armor BP</th>
                  <th class="sortable" data-sort="Vol">Vol</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="note">
            Armor = consistency vs armor scaling. Head Dep = Body/Head TTK ratio (normalized in cell, ðŸ”º = above dataset 75th percentile).
            Armor BP = normalized armor breakpoint score (Body TTK deltas, higher is better). Vol = TTK volatility across 0/L/M/H (lower is better).
          </div>
        </div>
      </div>

      <div class="sidebar">
        <div class="card">
          <div class="accordion" id="weightsAccordion">
            <div class="accHead">
              <b>Weights &amp; Model</b>
              <span class="subtle" id="weightsHint">click to expand</span>
            </div>
            <div class="accBody" id="weightsBody">
              <div class="subtle" style="margin-bottom:10px;">
                Presets auto-fill sliders. Switching to <b>Custom</b> will lock your values.
              </div>

              <div class="sliderRow">
                <label for="w_ttk">TTK (inverse)</label>
                <input type="range" min="0" max="100" value="30" id="w_ttk" />
                <output id="o_ttk">30</output>
              </div>
              <div class="sliderRow">
                <label for="w_sustain">Sustained DPS</label>
                <input type="range" min="0" max="100" value="20" id="w_sustain" />
                <output id="o_sustain">20</output>
              </div>
              <div class="sliderRow">
                <label for="w_handling">Handling</label>
                <input type="range" min="0" max="100" value="15" id="w_handling" />
                <output id="o_handling">15</output>
              </div>
              <div class="sliderRow">
                <label for="w_range">Range</label>
                <input type="range" min="0" max="100" value="15" id="w_range" />
                <output id="o_range">15</output>
              </div>
              <div class="sliderRow">
                <label for="w_reload">Reload (inverse)</label>
                <input type="range" min="0" max="100" value="10" id="w_reload" />
                <output id="o_reload">10</output>
              </div>
              <div class="sliderRow">
                <label for="w_armor">Armor Consistency</label>
                <input type="range" min="0" max="100" value="10" id="w_armor" />
                <output id="o_armor">10</output>
              </div>

              <div class="note">
                The system automatically re-normalizes your weights to sum to 1.0 when scoring.
              </div>

              <div class="weight-actions">
                <button class="secondary" id="resetPresetBtn">Reset Preset</button>
                <button class="secondary" id="customWeightsBtn">Use Custom</button>
              </div>

              <div class="warn" style="margin-top:10px;">
                Sustained DPS is approximated from TTK+STK to infer firing cadence where possible (no explicit ROF in CSV).
              </div>
            </div>
          </div>
        </div>

        <div class="card" id="detailPanel">
          <h2 id="dName">Select a Weapon</h2>
          <p id="dCat" class="detail-category">---</p>
          <div id="dStats">
            <p class="subtle">Click a weapon in the table to see scoring breakdown, derived metrics, rarity, and sell value.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="assets/js/main.js"></script>
</body>
</html>
